# 000_PROJECT_STATUS.md - BUNGU SQUAD Arena 重要事項管理

## 🎯 プロジェクト状態（最終更新: 2025-12-30）

### 現在のステータス
- **稼働状況**: 本番運用中 ✅
- **URL**: https://ranking.bungu-squad.jp
- **最新デプロイ**: 2025年10月（AdminPlayers改善、URL routing実装）
- **データベース**: Google Sheets API（ゼロコスト運用）
- **ホスティング**: Vercel（無料プラン → 商用時Pro移行）

### 直近の修正履歴
1. **管理者ダッシュボード参加者カード遷移修正** (374f826)
2. **AdminPlayers「アクティブにする」大会選択式エントリー変更** (9367893)
3. **AdminPlayers詳細画面UI/UX改善** (4574cb2)
4. **QRエントリー画面に既存ユーザーログイン追加** (8c551f7)
5. **TournamentMatchmaking UX改善** (7d2151c)

---

## 🚨 本日の作業（2025-12-30）

### 【緊急】年末処理タスク

#### 1. 年間チャンピオンバッジ自動付与（12/31実行）
- **目的**: 12/31 23:59時点のランキングで上位3名にバッジ付与
- **バッジ**: 1位🥇、2位🥈、3位🥉
- **既存実装**: `archiveYearlyRankings()` がapi/lib/sheets.jsに存在
- **TODO**:
  - [ ] Vercel Cronで12/31に自動実行する仕組み構築
  - [ ] または手動実行用のスクリプト/管理画面ボタン準備
  - [ ] 実績ページでの年度別表示確認

#### 2. 年明けレーティングリセット（1/1実行）
- **目的**: 1/1に全プレイヤーのレーティングを1200にリセット
- **既存実装**: なし（新規実装必要）
- **TODO**:
  - [ ] `resetYearlyRatings()` メソッド実装
  - [ ] annual_wins, annual_lossesもリセット
  - [ ] Vercel Cronで1/1に自動実行

#### 3. 実績ページの表示確認
- **チャンピオンバッジセクション**: 年度ごとのバッジ履歴表示（2025年、2026年...）
- **年間成績セクション**: 年度ごとの成績表示（現在年度は「進行中」）
- **TODO**:
  - [ ] YearlyArchiveからの正しいデータ取得確認
  - [ ] 2026年度への切り替わり確認

### 【本日】データベース整理タスク

#### 4. Google Sheetsシート整理
- **問題**: 不要なシートが存在、ヘッダーのずれ
- **TODO**:
  - [ ] 現在のシート一覧を確認
  - [ ] 使用中/未使用シートを判定
  - [ ] 不要シート削除（バックアップ後）
  - [ ] docs/064の構造ドキュメント更新

---

## 📌 今後の開発TODO

### 🟡 緊急度：中（次回大会までに）

#### 1. 試合開始・勝敗確定の反応速度改善
- **現状**: 1分程度かかることがある
- **改善**: 即座に反映されるよう高速化

#### 2. 組み合わせ生成のバランス改善
- **課題1**: ランダム組み合わせで特定プレイヤーが偏る
- **課題2**: 同じプレイヤーが連続出場してしまう

#### 3. 大規模大会対応（10人以上）
- **課題**: 総当たりが時間的に困難
- **改善案**: グループ分け機能

---

## 🐛 既知の問題・バグ

### 修正済み（最近）
- ✅ 試合編集時のレーティング二重計算
- ✅ PWAでキーボードが画面を隠す問題
- ✅ 完了試合編集時の重複作成

### 未解決・要調査
1. **大規模大会でのパフォーマンス**
   - 100人以上でGoogle Sheets APIレート制限の可能性
   - 対策: キャッシュ層追加検討

2. **オフライン時の挙動**
   - PWAキャッシュが不完全
   - Service Worker改善必要

---

## 💡 技術的改善案

### パフォーマンス最適化
1. **Redis/Upstash KV導入**
   - 現在未使用のUpstash KVを活用
   - APIレスポンスキャッシュ
   - リアルタイムデータの一時保存

2. **データベース移行検討**
   - Supabase移行でリアルタイム性向上
   - コスト: 月額$25〜
   - 移行スクリプト要作成

### コード品質向上
1. **テストカバレッジ向上**
   - 現在: テストなし
   - 目標: 主要機能80%カバレッジ
   - Jest + React Testing Library導入

2. **型安全性強化**
   - API レスポンスの型定義
   - Zodによるランタイム検証

---

## 📊 運用状況

### 利用実績
- **稼働期間**: 2025年7月〜現在
- **開催大会数**: 10+ 回
- **登録プレイヤー**: 50+ 人
- **累計試合数**: 500+ 試合

### コスト
- **現在**: 月額 $0（無料枠内）
- **商用移行時**: 月額約3,000円
  - Vercel Pro: $20/月
  - ドメイン: 約$10/年

### パフォーマンス指標
- **API応答時間**: 平均200-500ms
- **ページロード**: 1-2秒
- **Google Sheets API使用量**: 月10万リクエスト以下

---

## 🔧 メンテナンス情報

### 定期作業
- **週次**: ログ確認、エラー監視
- **月次**: Google Sheets容量確認、バックアップ
- **年次**: 依存関係更新、セキュリティ監査、**年間チャンピオン確定＆レーティングリセット**

### 緊急時対応手順
1. **システムダウン時**
   ```bash
   # Vercel状態確認
   vercel logs --follow

   # キャッシュクリア
   ./purge_cache.sh

   # 手動デプロイ
   vercel --prod
   ```

2. **データ破損時**
   ```bash
   # Google Sheetsから手動復旧
   node scripts/backup-restore.js
   ```

3. **API制限時**
   - Google Cloud Consoleで制限確認
   - 必要に応じて有料プラン検討

---

## 📚 重要ドキュメント参照

### 必読ドキュメント
- `CLAUDE.md` - プロジェクト固有の開発ルール
- `SHEETS_SETUP.md` - Google Sheets構造詳細
- `docs/036-tournament-lifecycle-overview.md` - 大会ライフサイクル
- `docs/050-pwa-notification-system.md` - PWA実装詳細
- `docs/064_spreadsheet_structure_full.md` - スプレッドシート完全構造

### API仕様
- `/api/tournaments.js` - 大会管理
- `/api/matches.js` - 試合管理
- `/api/players.js` - プレイヤー管理
- `/api/rankings.js` - ランキング
- `/api/yearly-archive.js` - 年間アーカイブ

---

## 🤝 連絡先・サポート

### 開発者
- **名前**: 菊池健司（ちーけん）
- **GitHub**: @kenjireds08
- **対応可能**: 機能追加、バグ修正、保守運用

### クライアント
- **蕨迫様（わらびさこ）**: BUNGU SQUAD運営
- **定例MTG**: 月1回程度
- **連絡方法**: メール、Discord

---

## ⚠️ 注意事項

1. **Upstash KV削除予告**
   - 現在未使用のため削除されても影響なし
   - 将来的にキャッシュ層として再利用可能

2. **Google Sheets制限**
   - 無料枠: 500万セル、月間APIリクエスト上限あり
   - 大規模化時はDB移行検討必要

3. **商用利用時**
   - Vercel Pro契約必須（規約違反回避）
   - SSL証明書自動更新確認

---

最終更新: 2025-12-30
更新者: Claude Code (ちーけんさん依頼)
