# 000_PROJECT_STATUS.md - BUNGU SQUAD Arena 重要事項管理

## 🎯 プロジェクト状態（最終更新: 2026-01-01）

### 現在のステータス
- **稼働状況**: 本番運用中 ✅
- **URL**: https://ranking.bungu-squad.jp
- **最新デプロイ**: 2026年1月1日（年末年始処理・UI改善）
- **データベース**: Google Sheets API（ゼロコスト運用）
- **ホスティング**: Vercel（無料プラン → 商用時Pro移行）

### 直近の修正履歴
1. **2025年度年間アーカイブ作成＆2026年度リセット完了** (2026-01-01)
   - YearlyArchiveに全16名のデータを追加
   - 上位3名にチャンピオンバッジ付与（🥇ヨッスィーオ、🥈ワラビサコ、🥉ヒカリマル）
   - 全プレイヤーのcurrent_rating→1200、annual_wins/losses→0にリセット
2. **UI改善** (2d71729)
   - トップページ: メダルバッジのみ表示（ルール習得バッジ非表示）
   - ランキングページ: 大会未開催時メッセージ表示
   - 実績ページ: 年間成績の順位表示を大会未参加時は「-」に
   - チャンピオンバッジ日付を年度末に固定
3. **Codex指摘対応** (682a1e6)
   - api/lib/sheets.js: JST基準の年度フィルタ＆欠損データスキップ
   - fix-yearly-archive-2025.mjs: 安全な再実行対応

---

## ✅ 完了済み作業（2026-01-01）

### 【完了】年末年始処理タスク

#### 1. 年間チャンピオンバッジ自動付与 ✅
- **結果**: スクリプト `scripts/fix-yearly-archive-2025.mjs` で手動実行
- **バッジ**: 🥇ヨッスィーオ、🥈ワラビサコ、🥉ヒカリマル
- **注意**: Vercel Cronは実行されたが `annual_wins/losses = 0` でフィルタされたため、手動でCSVから集計して実行

#### 2. 年明けレーティングリセット ✅
- **結果**: 同スクリプトで全プレイヤーをcurrent_rating=1200、annual_wins/losses=0にリセット

#### 3. 実績ページの表示修正 ✅
- 大会未参加時の順位表示を「-」に変更
- チャンピオンバッジ日付を年度末（12/31）に固定
- 右上バッジを「大会未参加」に変更

---

## 📌 今後の開発TODO

### 🔴 緊急度：高（次回実装予定）

#### 1. 年間成績詳細ポップアップ機能【新規】
- **目的**: 実績ページの年間成績をタップして、その年度の詳細を表示
- **表示内容**:
  - 参加大会一覧（その年にどの大会に出たか）
  - 大会ごとの成績（各大会での勝敗）
  - 対戦相手別成績（誰と何勝何敗か＝相性把握）
- **データソース**: TournamentMatches + Tournaments
- **棲み分け**:
  - 統計ページ: 累計データ、直近10戦
  - 履歴ページ: 全対戦履歴
  - 実績ページ年間成績: その年度のサマリー→詳細ポップアップ
- **見送り項目**:
  - 月別グラフ（月1開催＆参加率まちまちで寂しくなる）
  - レート推移グラフ（現状、最終レートのみ保存で実装困難）

### 🟡 緊急度：中（次回大会までに）

#### 2. 試合開始・勝敗確定の反応速度改善
- **現状**: 1分程度かかることがある
- **改善**: 即座に反映されるよう高速化

#### 3. 組み合わせ生成のバランス改善
- **課題1**: ランダム組み合わせで特定プレイヤーが偏る
- **課題2**: 同じプレイヤーが連続出場してしまう

#### 4. 大規模大会対応（10人以上）
- **課題**: 総当たりが時間的に困難
- **改善案**: グループ分け機能

---

## 🐛 既知の問題・バグ

### 修正済み（最近）
- ✅ 試合編集時のレーティング二重計算
- ✅ PWAでキーボードが画面を隠す問題
- ✅ 完了試合編集時の重複作成

### 未解決・要調査
1. **大規模大会でのパフォーマンス**
   - 100人以上でGoogle Sheets APIレート制限の可能性
   - 対策: キャッシュ層追加検討

2. **オフライン時の挙動**
   - PWAキャッシュが不完全
   - Service Worker改善必要

---

## 💡 技術的改善案

### パフォーマンス最適化
1. **Redis/Upstash KV導入**
   - 現在未使用のUpstash KVを活用
   - APIレスポンスキャッシュ
   - リアルタイムデータの一時保存

2. **データベース移行検討**
   - Supabase移行でリアルタイム性向上
   - コスト: 月額$25〜
   - 移行スクリプト要作成

### コード品質向上
1. **テストカバレッジ向上**
   - 現在: テストなし
   - 目標: 主要機能80%カバレッジ
   - Jest + React Testing Library導入

2. **型安全性強化**
   - API レスポンスの型定義
   - Zodによるランタイム検証

---

## 📊 運用状況

### 利用実績
- **稼働期間**: 2025年7月〜現在
- **開催大会数**: 10+ 回
- **登録プレイヤー**: 50+ 人
- **累計試合数**: 500+ 試合

### コスト
- **現在**: 月額 $0（無料枠内）
- **商用移行時**: 月額約3,000円
  - Vercel Pro: $20/月
  - ドメイン: 約$10/年

### パフォーマンス指標
- **API応答時間**: 平均200-500ms
- **ページロード**: 1-2秒
- **Google Sheets API使用量**: 月10万リクエスト以下

---

## 🔧 メンテナンス情報

### 定期作業
- **週次**: ログ確認、エラー監視
- **月次**: Google Sheets容量確認、バックアップ
- **年次**: 依存関係更新、セキュリティ監査、**年間チャンピオン確定＆レーティングリセット**

### 緊急時対応手順
1. **システムダウン時**
   ```bash
   # Vercel状態確認
   vercel logs --follow

   # キャッシュクリア
   ./purge_cache.sh

   # 手動デプロイ
   vercel --prod
   ```

2. **データ破損時**
   ```bash
   # Google Sheetsから手動復旧
   node scripts/backup-restore.js
   ```

3. **API制限時**
   - Google Cloud Consoleで制限確認
   - 必要に応じて有料プラン検討

---

## 📚 重要ドキュメント参照

### 必読ドキュメント
- `CLAUDE.md` - プロジェクト固有の開発ルール
- `SHEETS_SETUP.md` - Google Sheets構造詳細
- `docs/036-tournament-lifecycle-overview.md` - 大会ライフサイクル
- `docs/050-pwa-notification-system.md` - PWA実装詳細
- `docs/064_spreadsheet_structure_full.md` - スプレッドシート完全構造

### API仕様
- `/api/tournaments.js` - 大会管理
- `/api/matches.js` - 試合管理
- `/api/players.js` - プレイヤー管理
- `/api/rankings.js` - ランキング
- `/api/yearly-archive.js` - 年間アーカイブ

---

## 🤝 連絡先・サポート

### 開発者
- **名前**: 菊池健司（ちーけん）
- **GitHub**: @kenjireds08
- **対応可能**: 機能追加、バグ修正、保守運用

### クライアント
- **蕨迫様（わらびさこ）**: BUNGU SQUAD運営
- **定例MTG**: 月1回程度
- **連絡方法**: メール、Discord

---

## ⚠️ 注意事項

1. **Upstash KV削除予告**
   - 現在未使用のため削除されても影響なし
   - 将来的にキャッシュ層として再利用可能

2. **Google Sheets制限**
   - 無料枠: 500万セル、月間APIリクエスト上限あり
   - 大規模化時はDB移行検討必要

3. **商用利用時**
   - Vercel Pro契約必須（規約違反回避）
   - SSL証明書自動更新確認

---

最終更新: 2026-01-01
更新者: Claude Code (ちーけんさん依頼)
