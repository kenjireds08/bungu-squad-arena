# BUNGU SQUAD ランキングシステム 要件定義書

**プロジェクト名**: BUNGU SQUAD ランキングシステム  
**バージョン**: 3.0（最新版・技術構成変更）  
**作成日**: 2025年07月23日  
**承認者**: ワラビサコさん、ヨッスィーオさん  
**開発者**: ちーけん

---

## 1. プロジェクト概要

### 1.1 目的
BUNGU SQUADボードゲームのプレイヤーランキングを管理し、年間チャンピオンを決定するスマートフォン対応Webアプリケーションの構築。プレイヤーのモチベーション向上と公正で楽しい競技環境の提供を目指します。

### 1.2 このシステムで解決すること
- **現在**: 小規模大会を実施 → **改善後**: 年間を通じた継続ランキング
- **現在**: 手作業での記録管理 → **改善後**: 自動計算・リアルタイム更新
- **現在**: プレイヤーの実力が不明 → **改善後**: 数値とグラフで実力可視化
- **現在**: 大会参加の煩雑な手続き → **改善後**: QRコードで瞬時参加

### 1.3 開発の進め方
**統合開発（8月8日の合宿まで）**:
- ✅ 統合ランキングシステム（トランプ・カードプラス両ルール対応）
- ✅ 対戦記録とEloレーティング自動計算
- ✅ K値の動的調整（対戦数10以下：K=40、11〜50：K=20、51以上：K=10）
- ✅ プレイヤー申告→管理者承認の基本フロー
- ✅ QRコード大会参加システム
- ✅ ルールバッジシステム（♠️➕でルール習熟度表示）
- ✅ レート変動グラフ機能
- ✅ チャンピオンバッジ表示機能（★☆⭐）
- ✅ 大会管理機能（組み合わせ作成・対戦ルール選択）
- ✅ PWA化（ホーム画面追加・オフライン対応・ネイティブアプリ体験）
- ✅ 複数管理者対応（ちーけんさん・ワラビサコさん・ヨッスィーオさんの3名体制）

**将来的な拡張（8月8日以降）**:
- ✅ 大会グレード別K値調整機能
- ✅ 詳細統計分析機能
- ✅ CSV/PDFエクスポート機能
---

## 2. システムで何ができるようになるか

### 2.1 プレイヤーの皆さんができること

#### 📱 簡単に大会に参加
- **QRコードをスマホで読み取る**だけで大会に参加登録完了
- **アプリ内カメラ**または**通常のカメラアプリ**どちらでも対応
- メイン画面の**「大会にエントリー」ボタン**で瞬時にカメラ起動
- 初回参加時はメールアドレスでカンタン登録
- **ニックネーム**と**プロフィール画像**を自由に設定可能

#### 📲 ホーム画面にアプリ追加（PWA機能）
- 初回サインイン後に**「ホーム画面に追加」**の案内表示
- スマホのホーム画面にアイコンが追加される
- 次回以降は**URLバー表示なし**でネイティブアプリのような体験
- **オフライン時**でも基本情報（ランキング・成績）を確認可能
- アプリストア不要で、すぐに使い始められる

#### 📊 自分の実力がすぐ分かる
- **現在のランキング順位**がリアルタイムで分かる
- **レーティングポイント**（実力の数値）が表示
- **次の順位に上がるには後何ポイント必要か**が分かる
- 自分のレート変動を**グラフ**で確認（上達が見える！）

#### 🏆 過去の栄光を表示
- 過去に**年間チャンピオン**になった人は名前の横に **金の星★**
- **準優勝**の人は **銀の星☆**、**3位**の人は **銅の星⭐**
- 複数回優勝すると星が増える（★★★）→ 「この人強い！」が一目で分かる

#### 🏷️ ルール習熟度の表示
- **♠️** トランプルールを理解済み（トランプルールでの対戦経験あり）
- **➕** カードプラスルールを理解済み（カードプラスルールでの対戦経験あり）
- **♠️➕** 両方のルールに対応可能（どちらの大会でも参加できる）
- **初心者マーク** まだルール習得中のプレイヤーも一目で分かる
- 大会運営時に適切な組み合わせ作成をサポート

#### 📝 対戦結果の申告
- 試合が終わったら**「勝った」「負けた」ボタン**をタップするだけ
- 管理者が確認後、レーティングが自動更新される

#### 📈 自分の成長を確認
- **過去の対戦履歴**を一覧表示
- **参加した大会の記録**を確認
- **年間成績**（何勝何敗、何試合参加）が分かる
- **累積データ**（初回参加日、総対戦数、通算勝率）を表示
- **年別実績**（過去各年の順位・最高レーティング）を確認
- **長期成長グラフ**（全参加期間の実力変遷）を表示

#### 📅 大会情報の確認
- **次回大会予定**の自動表示（管理者が作成すると即座に反映）
- **大会詳細**（日時・場所・参加方法）を確認
- **参加予定**の大会一覧表示

### 2.2 管理者（運営者）ができること

#### 🎯 大会の作成と管理
- **日時・場所を入力**して新しい大会を作成
- 大会作成と同時に**専用QRコード**を自動生成
- **作成と同時に全プレイヤーに大会予定を自動通知**
- 会場でQRコードを表示して参加者を募集
- **大会一覧**で過去・現在・未来の大会を管理

#### 📋 対戦の組み合わせ設定
**3つの方法から選べます：**
1. **ランダム**：システムが自動で組み合わせ
2. **総当たり**：全員が全員と対戦
3. **手動設定**：管理者がドラッグ&ドロップで自由に組み合わせ

**🎯 ルール選択機能**：
- **各対戦でルールを指定**：「トランプルール」「カードプラスルール」を選択可能
- **プレイヤーのルールバッジを確認**：♠️➕マークを見ながら適切な組み合わせを作成
- **ルール統計**：どちらのルールで何戦行われたかを自動集計
- **自動バッジ付与**：対戦完了時にプレイヤーにルール習得マークを自動付与

#### 🎮 試合進行の管理
**試合の状況が一目で分かる画面**
- **現在対戦中**のペア表示
- **次の対戦予定**のリスト
- **勝敗報告待ち**の試合一覧
- **承認待ち**の申告リスト

#### ✅ 勝敗結果の承認
- プレイヤーからの勝敗申告を**承認・却下**
- または管理者が**直接結果を入力**も可能
- 承認と同時にレーティングが自動計算・更新

#### 📄 データの出力と管理
- 各大会の結果を**CSV形式**でエクスポート
- 年間ランキングを**PDF**で出力（表彰式用）
- 新規参加者の登録申請を承認・管理

### 2.3 システム全体の特徴

#### 🔄 年間サイクル管理
- **期間**: 毎年1月1日〜12月31日
- **年末**: 年間ランキング確定・チャンピオン決定
- **年始**: レーティングリセット・新シーズン開始
- **過去データ**: 前年のデータは履歴として永久保存

#### 📊 累積記録システム（永続保存）
**年間ランキングとは別に、全期間のデータを蓄積**
- **累積レーティング**: リセットされない通算実力値
- **参加履歴**: 初回参加日、総対戦数、通算勝敗数
- **年別実績**: 過去各年の最終順位・最高レーティング
- **実力の変遷**: 長期的な成長・変化のグラフ表示
- **コミュニティ貢献**: 「○年からの参加者」「通算○○勝」等の表示

#### 🏅 チャンピオンバッジシステム
- **金の星★**: 年間1位
- **銀の星☆**: 年間2位  
- **銅の星⭐**: 年間3位
- 同じ人が複数回入賞すると星の数が増加

#### 📱 スマートフォン対応
- **スマホ最優先**の画面設計
- 大会会場での操作を想定した使いやすいUI
- QRコード読み取り機能

---

## 3. システムの技術的な仕組み

### 3.1 使用技術（開発者向け情報）
- **フロントエンド**: Next.js 14 + TypeScript + Tailwind CSS
- **状態管理**: Zustand
- **UIコンポーネント**: shadcn/ui
- **データ取得**: TanStack Query (React Query)
- **バックエンド**: Vercel Serverless Functions + TypeScript
- **データベース**: Google スプレッドシート (Google Sheets API v4経由)
- **ホスティング**: Vercel
- **PWA対応**: Service Worker + Web App Manifest（ホーム画面追加対応）
- **ドメイン**: bungu-squad.jp（取得済み）

### 3.2 なぜこの技術を選んだか
**コスト面:**
- Google スプレッドシート：**完全無料**
- Vercel Serverless Functions：**無料果内で十分** (100GB-時間/月)
- Google Sheets API：**完全無料** (日限100リクエスト/ユーザー)
- Vercel：**無料プラン**で十分対応可能
- **合計月額コスト：ドメイン代のみ（年間1,000円程度）**

**開発・運用面:**
- **スマートフォン最適化**が簡単
- **リアルタイム更新**が可能
- **データの安全性**が高い（Googleのインフラ）
- **将来の機能追加**が容易

### 3.3 システムの安全性
- **セキュア通信**: 全ての通信をHTTPS暗号化
- **データ保護**: Googleの高セキュリティインフラを利用
- **アクセス制御**: 管理者とプレイヤーの権限を分離
- **個人情報**: 最小限の情報のみ収集（メールアドレス・ニックネーム）

### 3.4 Eloレーティング方式の詳細

#### 📊 Eloレーティングとは
チェスや将棋など世界中で使われている、実力を数値化する公平な計算方式です。
対戦相手の強さを考慮して、勝敗によるポイント変動を計算します。

#### ✅ 基本計算式
```
R' = R + K × (W - We)
```

**記号の意味**：
- **R**: 自分の現在レート
- **R'**: 対戦後の新レート
- **K**: 変動係数（K=20を基本とする）
- **W**: 実際の勝敗（勝ち＝1、負け＝0）
- **We**: 勝率期待値（相手とのレート差によって決まる）

#### 📈 勝率期待値（We）の計算式
```
We = 1 / (1 + 10^((相手R - 自分R) / 400))
```

#### 🧮 計算例
**ケース：自分1500pt vs 相手1600pt（K=20）**

1. **勝率期待値の計算**：
   - We = 1 / (1 + 10^((1600-1500)/400))
   - We = 1 / (1 + 10^(0.25))
   - We ≒ 0.36（36%の勝率期待）

2. **勝った場合**：
   - R' = 1500 + 20 × (1 - 0.36)
   - R' = 1500 + 12.8
   - **新レート：約1513pt（+13pt）**

3. **負けた場合**：
   - R' = 1500 + 20 × (0 - 0.36)
   - R' = 1500 - 7.2
   - **新レート：約1493pt（-7pt）**

#### 🎯 K値の設定（将来的な実装）
プレイヤーの対戦数に応じてK値を調整し、より公平なレーティングを実現：
- **初心者（対戦数10以下）**: K=40（変動大きめ）
- **中級者（対戦数11〜50）**: K=20（標準）
- **上級者（対戦数51以上）**: K=10（変動小さめ）

※8月8日リリース時から対戦数による動的K値調整を実装

### 3.5 PWA（Progressive Web App）化の詳細

#### 📲 PWA化とは
Webアプリをスマートフォンのホーム画面に追加し、ネイティブアプリのような体験を提供する技術です。
App Store等からのダウンロード不要で、URLからアクセス後すぐにアプリ化できます。

#### ✅ BUNGU SQUADでのPWA活用メリット
1. **大会会場での利便性向上**
   - ホーム画面アイコンから1タップで起動
   - URLバーなしでの表示（画面を最大活用）
   - カメラ機能への素早いアクセス

2. **日常的な利用促進** 
   - ランキング確認が気軽に
   - 次回大会予定の確認が簡単
   - アプリのような使用感

3. **オフライン対応**
   - 基本情報（ランキング・過去成績）はオフラインでも閲覧可能
   - 会場のWi-Fi不調時も安心

#### 🛠️ 技術実装要素
- **Web App Manifest**: アプリアイコン・起動設定を定義
- **Service Worker**: オフライン対応・キャッシュ管理
- **beforeinstallprompt**: インストール案内の表示制御（Android）
- **iOS対応**: 「ホーム画面に追加」手順ガイド表示

#### 📱 初回ユーザー体験フロー
1. **QRコード読み取り** → Webアプリが開く
2. **サインイン** → アカウント作成または既存ログイン  
3. **PWA案内ポップアップ** → 「ホーム画面に追加してより便利に！」
4. **ホーム追加** → 以降はアプリアイコンから起動可能

---

## 4. データの保存方法

### 4.1 Googleスプレッドシート構成
**シート1: プレイヤー情報**
- プレイヤーID, ニックネーム, メールアドレス, 現在のレーティング
- 年間勝敗数, 累積勝敗数, 獲得バッジ（金・銀・銅の星）
- trump_rule_experienced（トランプルール習得済み）, first_trump_game_date（初回トランプルール参加日）
- cardplus_rule_experienced（カードプラスルール習得済み）, first_cardplus_game_date（初回カードプラスルール参加日）
- 登録日, プロフィール画像

**シート2: 対戦記録**
- 対戦ID, 対戦者A, 対戦者B, 勝者, 敗者
- 対戦日時, 申告日時, 承認日時, 承認者
- 大会ID, レーティング変動値, 試合ステータス
- game_rule（使用ルール：trump/cardplus）

**シート3: 大会情報**
- 大会ID, 大会名, 開催日時, 開催場所
- QRコード, 作成者, 参加者リスト

**シート4: 大会参加記録**
- 参加ID, 大会ID, プレイヤーID, 参加日時

**シート5: 年間実績アーカイブ**
- 年度, プレイヤーID, 最終レーティング, 年間順位
- 獲得バッジ, 年間勝敗数

**シート6: 累積記録データ**
- プレイヤーID, 初回参加日, 累積レーティング
- 総対戦数, 通算勝敗数, 通算勝率
- 参加年数, 最高レーティング（年度別）

### 4.2 試合の進行ステータス管理
各試合は以下の5つの状態で管理されます：

1. **未開始** - 対戦カードは決定済み、まだ試合開始前
2. **対戦中** - 現在この2人が試合中（リアルタイム表示）
3. **勝敗報告待ち** - 試合終了、プレイヤーからの申告待ち
4. **承認待ち** - プレイヤーが申告済み、管理者の確認待ち
5. **完了** - 勝敗確定、レーティング更新済み

---

## 5. 画面の構成とデザイン

### 5.1 デザインのコンセプト
**BUNGU SQUAD公式ルールブックと同じ世界観**
- 羊皮紙風の温かい背景色（#F5F1E8）
- 金色の装飾フレーム（#DAA520）
- ファンタジーRPG風のデザイン要素
- 公式キャラクター（文房具戦士たち）を活用

#### 🎨 カラーパレット
- **背景**: #F5F1E8（羊皮紙ベージュ）
- **メインテキスト**: #3C2415（ダークブラウン）
- **アクセント**: #DAA520（金色）
- **フレーム**: #CD853F（ブロンズ）
- **強調**: #B22222（赤）、#228B22（緑）、#4169E1（青）

#### 🖼️ キャラクター・ロゴ配置方針
**ロゴ配置**：
- **BUNGU SQUADロゴ**：各画面の左上に固定表示
- **ファビコン・PWAアイコン**：main-character.png使用

**キャラクター活用**：
- **背景装飾**：透明度30-40%で薄く表示（スマホ配慮）
- **ローディング画面**：大きくアニメーション表示
- **専用画面**：設定・統計画面では大きめに配置
- **エラー画面**：困った表情で案内役

**スマホ最適化**：
- キャラクターが小さくて見づらい場合は背景として活用
- 重要な情報の邪魔にならない配置
- タッチしやすいボタンサイズの確保

#### 🎭 キャラクター別活用方法
**main-character.png**：
- PWAアイコン（ホーム画面表示用）
- ファビコン（ブラウザタブ表示用）

**pencil.png（鉛筆戦士）**：
- メイン画面の背景装飾
- ランクアップ時の祝福演出

**eraser.png（消しゴム重装兵）**：
- 大会エントリー完了画面の歓迎役
- 敗北時の慰め演出

**scissors.png（はさみ戦士）**：
- メイン画面の背景装飾（鉛筆戦士と対）
- 勝利時の喜び演出

**tape.png（テープ忍者）**：
- QRカメラ起動時の案内役
- 大会参加時の歓迎演出

**glue.png（のり獣人）**：
- ローディング画面のアニメーション
- エラー画面での困った表情案内

#### 📱 画面別キャラクター配置
- **メイン画面**: 鉛筆戦士＋はさみ戦士（薄い背景）
- **QRカメラ画面**: テープ忍者（案内役）
- **ローディング画面**: のり獣人（アニメーション）
- **エラー画面**: 消しゴム重装兵（案内役）
- **統計画面**: 全キャラクター（装飾として）

### 5.2 プレイヤーが見る画面

#### 📱 メイン画面（ダッシュボード）- スマホ最適化版
```
┌─────────────────────────────────┐
│ 🏆 BUNGU SQUAD        [≡メニュー] │
├─────────────────────────────────┤
│                                 │
│        🥉 現在 3位              │
│        ⭐ 1,650pt               │
│      📈 2位まで後35pt！          │
│                                 │
│     [📱 大会にエントリー]        │
│                                 │
│ 🗓️ 次回大会予定                │
│ 第8回BUNGU SQUAD大会           │
│ 8/15(木) 19:00〜              │
│ 場所：○○コミュニティセンター    │
│                                 │
│      (薄いキャラクター装飾)       │
└─────────────────────────────────┘
```

#### 📱 メニュー画面
```
┌─────────────────────────────────┐
│ ≡ メニュー                [×閉じる] │
├─────────────────────────────────┤
│                                 │
│ 📊 統計                         │
│    累積データ・レート変動グラフ   │
│                                 │
│ 🏆 実績                         │
│    獲得バッジ・年間成績          │
│                                 │
│ 📋 履歴                         │
│    対戦記録・大会参加履歴        │
│                                 │
│ ⚙️ 設定                         │
│    プロフィール・通知設定        │
│                                 │
│ ❓ ヘルプ                       │
│    使い方・ルール説明           │
│                                 │
└─────────────────────────────────┘
```

#### 📋 対戦待機画面
```
┌─────────────────────────────────┐
│ 🏆 BUNGU SQUAD        [≡メニュー] │
├─────────────────────────────────┤
│                                 │
│ 🎯 対戦情報                     │
│                                 │
│ 対戦相手：田中さん ♠️➕         │
│ 卓番号：卓2                     │
│ ルール：カードプラスルール       │
│                                 │
│    [🎮 対戦開始]                │
│                                 │
│ 📅 大会：第8回BUNGU SQUAD大会   │
│ ⏰ 開始予定：19:30〜            │
│                                 │
│     (テープ忍者が案内)           │
└─────────────────────────────────┘
```

#### 🎮 対戦中画面
```
┌─────────────────────────────────┐
│ 🏆 BUNGU SQUAD        [≡メニュー] │
├─────────────────────────────────┤
│                                 │
│ ⚔️ 対戦中                       │
│                                 │
│ あなた vs 田中さん              │
│ 卓2・カードプラスルール          │
│                                 │
│ ⏱️ 対戦時間：15分経過            │
│                                 │
│    [🏁 試合終了・結果報告]       │
│                                 │
│ 💡 試合が終わったら上のボタンを  │
│    押して結果を報告してください   │
│                                 │
│     (鉛筆戦士＋はさみ戦士)       │
└─────────────────────────────────┘
```

#### 📝 対戦結果報告画面
```
┌─────────────────────────────────┐
│ 🏆 BUNGU SQUAD        [≡メニュー] │
├─────────────────────────────────┤
│                                 │
│ 📝 試合結果の報告               │
│                                 │
│ 対戦相手：田中さん              │
│ ルール：カードプラスルール       │
│ 卓：卓2                        │
│                                 │
│ あなたの結果は？                │
│                                 │
│  [🏆 勝った] [😢 負けた]       │
│                                 │
│     [📤 申告する]               │
│                                 │
│     (消しゴム重装兵が待機)       │
└─────────────────────────────────┘
```

#### 📋 結果報告完了画面
```
┌─────────────────────────────────┐
│ 🏆 BUNGU SQUAD        [≡メニュー] │
├─────────────────────────────────┤
│                                 │
│ ✅ 報告完了！                   │
│                                 │
│ 管理者の承認をお待ちください      │
│                                 │
│ 田中さん vs あなた              │
│ 結果：あなたの勝利              │
│                                 │
│ 📊 承認後にレーティングが        │
│    更新されます                 │
│                                 │
│   [🏠 メイン画面に戻る]          │
│                                 │
│     (全キャラクターが祝福)       │
└─────────────────────────────────┘
```

#### 🏆 ランキング画面
```
┌─────────────────────────────────┐
│ 🥇 1位 鈴木さん ★★☆♠️➕ 1,850pt │
│ 🥈 2位 佐藤さん ★♠️ 1,685pt     │
│ 🥉 3位 あなた ➕ 1,650pt        │
│ 4位 田中さん ♠️➕ 1,620pt       │
│ 5位 山田さん ⭐➕ 1,580pt       │
└─────────────────────────────────┘
```
**バッジの意味**：
- ★☆⭐：年間チャンピオンバッジ（金・銀・銅）
- ♠️：トランプルール習得済み
- ➕：カードプラスルール習得済み

### 5.3 管理者が見る画面

#### 🎮 試合進行管理画面（改良版）
```
┌─────────────────────────────────┐
│ 📍 現在対戦中                   │
│ 鈴木さん vs 佐藤さん (卓1)      │
│ 田中さん vs 山田さん (卓2)      │
│                                 │
│ ⏰ 報告待ち（時間経過順）        │
│ 高橋さん vs 中村さん 開始25分   │
│ [📱催促通知] [🛠️代理入力]      │
│                                 │
│ ✅ 承認待ちの申告 (2件)         │
│ 山田さん勝利 vs 田中さん        │
│ [✅承認] [❌却下] [✏️修正]     │
│                                 │
│ 🔄 完了済み（本日）             │
│ 佐藤さん勝利 vs 鈴木さん ✓     │
│                                 │
│ 🗓️ 次回大会予定                │
│ 第9回BUNGU SQUAD大会           │
│ 8/22(木) 19:00〜              │
│ [詳細確認] [編集]              │
└─────────────────────────────────┘
```

#### 🛠️ 管理者バックアップ機能画面
```
┌─────────────────────────────────┐
│ 🛠️ 代理入力・修正               │
├─────────────────────────────────┤
│                                 │
│ 対戦情報                        │
│ 高橋さん vs 中村さん (卓3)      │
│ ルール：トランプルール           │
│                                 │
│ 代理入力理由                    │
│ □ プレイヤーが報告を忘れた      │
│ □ 技術的問題で報告できない      │
│ □ その他：＿＿＿＿＿＿＿        │
│                                 │
│ 試合結果                        │
│ [高橋さん勝利] [中村さん勝利]    │
│                                 │
│ [📝 代理入力実行]               │
│                                 │
│ ※プレイヤーに結果を自動通知します │
└─────────────────────────────────┘
```

#### 🎯 大会作成画面
```
┌─────────────────────────────────┐
│ 大会名：第○回BUNGU SQUAD大会    │
│ 日時：2025/○/○ ○○:○○         │
│ 場所：○○コミュニティセンター    │
│                                 │
│ 対戦方式：                      │
│ ○ ランダム ○ 総当たり ○ 手動  │
│                                 │
│ [大会作成 & QRコード生成]       │
└─────────────────────────────────┘
```

---

## 6. システムの使い方（運用の流れ）

### 6.1 🎮 大会当日の流れ

#### 準備（管理者）
1. **大会作成** - 管理者がアプリで新しい大会を作成
2. **QRコード表示** - 会場入口にQRコードを表示（PC・スマホどちらでもOK）
3. **対戦方式選択** - 参加者数に応じてランダム・総当たり・手動を選択

#### 参加登録（プレイヤー）
**2つの方法でQRコード読み取り可能：**
1. **アプリ内カメラ** - メイン画面の「大会にエントリー」ボタン→カメラ起動
2. **通常のカメラ** - iPhone標準カメラ等でQRコード読み取り→ブラウザ自動起動

**どちらの方法でも：**
1. **ログイン** - 初回はメールアドレスで簡単登録、2回目以降は自動ログイン
2. **PWA追加案内**（初回のみ） - サインイン後に「ホーム画面に追加」をポップアップで案内
3. **参加完了** - 自動的に大会にエントリー

**🔄 次回以降（PWA利用者）：**
1. **ホーム画面から起動** - URLバーなしでアプリのような起動
2. **カメラで読み取り** - PWA内のカメラ機能でQRコード読み取り
3. **即エントリー** - ログイン状態が保持されているため即座に参加完了

#### 試合進行（全員）
1. **対戦カード発表** - アプリで今日の対戦相手を確認
2. **対戦待機画面** - 試合前に相手情報・適用ルールを再確認、心の準備
3. **対戦中画面** - 管理者による「開始」操作で表示、経過時間カウント・終了ボタン表示
4. **結果申告画面** - 試合終了後、勝者・敗者が専用画面で「勝った」「負けた」ボタンを押す
5. **結果報告完了** - 申告後に「報告完了画面」で管理者承認待ちを表示
6. **結果承認** - 管理者が申告内容を確認・承認（または代理入力）
7. **自動更新** - レーティング自動計算、ランキング更新

#### 大会終了
1. **全試合完了確認** - 管理者画面で未処理がないかチェック
2. **結果発表** - 当日の順位とレーティング変動を確認
3. **データ保存** - CSV出力で記録保存（任意）

### 6.2 📅 年間サイクル

#### 年間運用
- **1月1日** - 新シーズン開始、年間レーティングリセット（全員1500からスタート）
- **1月〜12月** - 大会開催、年間＆累積レーティング両方を蓄積
- **12月31日** - 年間ランキング確定、チャンピオン決定

#### チャンピオン決定
1. **年末確定** - 12月31日時点の年間レーティング上位者を決定
2. **バッジ付与** - 1位→金星★、2位→銀星☆、3位→銅星⭐
3. **記録保存** - 年間データを永久保存＆累積データに統合
4. **年間リセット** - 翌年1月1日に年間レーティングのみリセット
5. **累積継続** - 累積レーティング・参加履歴は継続して蓄積

### 6.3 🛡️ トラブル対応・フロー問題の解決

#### よくある問題と解決法
**「勝敗申告が間違っていた」**
→ 管理者が却下して正しい結果を直接入力

**「QRコードが読み取れない」**
→ スタッフのスマホで代替表示、またはURLを直接共有

**「レーティング計算がおかしい」**
→ 管理者画面で結果を修正、レーティング再計算

**「参加者が重複している」**
→ 管理者がプレイヤー管理画面で重複アカウント統合

#### ハイブリッド管理による流れの改善
**問題**: プレイヤーが試合結果を申告し忘れる、反応が遅い
**解決**: 管理者バックアップ機能でスムーズな進行を保証

1. **基本フロー**: プレイヤーが自分で申告
2. **バックアップ**: 15分経過で管理者に代理入力の選択肢が表示
3. **代理入力**: 管理者が直接結果を入力（理由も記録）
4. **事後通知**: 代理入力時は対象プレイヤーにメール通知

#### 潜在的なボトルネック問題と対策

**1. 同時申告トラブル**
- **問題**: 勝者・敗者が同時に「勝った」と申告
- **対策**: 矛盾検知機能で管理者に確認依頼、最初の申告を一時保留

**2. プレイヤー通信断絶**
- **問題**: 試合中にWi-Fi切断・バッテリー切れで操作不能
- **対策**: 15分の自動タイムアウト＋管理者代理入力機能

**3. 管理者承認の遅延**
- **問題**: 管理者が他の試合に集中して承認が遅れる
- **対策**: 未処理件数の目立つ表示＋プッシュ通知（PWA機能）

**4. レーティング計算エラー**
- **問題**: 計算ミスやシステムエラーでレーティングが異常値
- **対策**: 変動幅チェック機能（±100以上の変動は要確認）

**5. データ整合性の問題**
- **問題**: 複数人が同時操作でデータ競合
- **対策**: Google Sheets APIのトランザクション機能とVercelのコンカレンシー制御を活用

---

## 7. 重要なポリシー

### 7.1 🎯 このシステムの特徴的なルール
- **革新的なアプローチ**: 大会ごとの優勝者は決めません
- **年間累積評価**: 1回の勝敗でなく、継続的な実力向上を評価
- **公認戦制**: 管理者立ち会いの試合のみランキングに反映
- **完全透明**: 全ての対戦結果を公開、不正やミスを防止

### 7.2 🔮 将来の発展可能性
**他のゲーム・コミュニティへの展開**
- ポケモンカード、遊戯王等の他TCG対応
- 他のボードゲームコミュニティでも利用可能

**地域・規模拡大**
- 関東・関西などの地域別大会
- オンライン大会（VR BUNGU SQUAD）との連携

**技術的成長**
- データ蓄積に応じてSupabase等の本格データベースに移行
- より高度な分析・予測機能の追加

### 7.3 📋 開始前に確認すること

#### 8月8日の合宿前までに完了予定
- ✅ 基本機能（対戦記録・レーティング・ランキング）
- ✅ 管理者承認システム
- ✅ QRコード大会参加システム
- ✅ スマートフォン最適化

#### 運用開始の条件
- 管理者向け操作マニュアル作成
- プレイヤー向け利用ガイド作成
- テストデータでの動作確認完了

---

## 8. 質問・要望・変更について

### 8.1 この要件定義について
**ワラビサコさん、ヨッスィーオさんへ**

この要件定義書をお読みいただき、以下についてご確認ください：

1. **機能の過不足** - 追加したい機能、不要な機能はありませんか？
2. **画面イメージ** - プレイヤー・管理者の画面イメージは分かりやすいですか？  
3. **運用フロー** - 実際の大会運営で問題ないでしょうか？
4. **優先順位** - 8月8日までの統合開発で問題ありませんか？

### 8.2 開発に向けて
**承認いただけましたら：**
- Google Sheets APIサービスアカウントの設定
- 本格的な開発作業開始

**変更・追加要望がある場合：**
- どの部分を変更・追加したいか
- その理由・背景
- 優先度（Phase 1必須 / できればPhase 2も同時に / 将来的に）

---

**📞 連絡先・次のステップ**
- 要件定義の確認・承認
- 技術的な質問や相談
- その他、システムに関するご要望

**作成者**: ちーけん
**確認・承認待ち**: ワラビサコさん、ヨッスィーオさん  
**文書バージョン**: 2.6（2025年7月23日 最新版）