# 年間サイクル・統計・実績システム設計

## 概要
BUNGU SQUADランキングシステムの年間運営サイクルと、統計・実績機能の詳細設計書です。

## 実装日時
設計日: 2025年8月2日  
実装予定: 2025年12月頃（年末リセット機能）

## 年間サイクル運営システム

### 年末自動処理（12月31日 23:59）
**自動実行される処理:**

1. **年間チャンピオン決定**
   - その時点のレーティング順位で自動決定
   - 🥇 1位：金メダルバッジ自動付与
   - 🥈 2位：銀メダルバッジ自動付与  
   - 🥉 3位：銅メダルバッジ自動付与

2. **統計データのアーカイブ**
   - 現年度の統計データを年別に保存
   - 履歴データとして永続保存

### 年始自動リセット（1月1日 00:00）
**リセットされるもの:**
- 全プレイヤーのレーティング → 1200
- 現在ランキング順位
- 年間勝率 → 0戦0勝
- 年間試合数カウンター

**保持されるもの:**
- プレイヤーアカウント（削除しない）
- 過去の大会履歴・試合記録
- 獲得済みチャンピオンバッジ（累積）
- 通算対戦数・統計データ
- マイルストーン達成記録

## データベース構造設計

### 年別履歴管理
**Google Sheetsタブ構成:**
```
現行データ:
- Players (現在のデータ)
- Tournaments (現在の大会)
- TournamentMatches (現在の試合)
- RatingHistory (現在のレーティング履歴)

年別アーカイブ:
- Players_2025 (2025年最終状態)
- Tournaments_2025 (2025年大会一覧)
- TournamentMatches_2025 (2025年試合履歴)
- RatingHistory_2025 (2025年レーティング履歴)
- ChampionHistory (年間チャンピオン記録)
```

### プレイヤーデータ構造拡張
```javascript
{
  // 現在のデータ
  current_rating: 1500,
  current_wins: 15,
  current_losses: 8,
  current_win_rate: 65.2,
  
  // 通算データ（リセットしない）
  total_matches: 147,
  total_wins: 89,
  total_losses: 58,
  total_win_rate: 60.5,
  
  // チャンピオンバッジ（累積）
  champion_badges: [
    { year: 2023, position: 2 }, // 銀メダル
    { year: 2024, position: 1 }, // 金メダル
  ],
  
  // マイルストーン達成記録
  milestones: [
    { type: "first_win", achieved_date: "2024-03-15" },
    { type: "rating_1600", achieved_date: "2024-07-22" },
    { type: "win_rate_50_percent", achieved_date: "2024-08-10" }
  ]
}
```

## 統計機能の詳細仕様

### 年間統計（年末リセット対象）
- **現在レーティング**: 年始1200からスタート
- **年間勝率**: 当年の試合のみで計算
- **年間試合数**: 当年の試合数
- **年間順位推移**: 月別レーティング変動グラフ

### 通算統計（永続保存）
- **通算対戦数**: 全期間の試合数
- **通算勝率**: 全期間の勝率
- **最高レーティング**: 歴代最高記録
- **連勝記録**: 歴代最長連勝
- **参加大会数**: 通算参加回数

## 実績システム（マイルストーン）

### チャンピオンバッジ実装
**表示例:**
```
ワラビサコ 🥇🥈🥉♠️➕
（2022金・2023銀・2024銅・トランプ・カード+）
```

**実績ページでの詳細表示:**
- 2025年: 🥇 年間チャンピオン
- 2024年: 🥈 年間準優勝  
- 2023年: 🥉 年間3位

### マイルストーン一覧

#### 基本マイルストーン
- ✅ **初勝利**: 初回勝利時
- ✅ **初大会参加**: 初回大会エントリー時
- ✅ **レーティング1600突破**: 1600到達時
- ✅ **レーティング1700突破**: 1700到達時
- ✅ **レーティング1800突破**: 1800到達時

#### 勝率系マイルストーン
- ✅ **勝率50%達成**: **10試合以上**で勝率50%以上達成時
- ✅ **勝率60%達成**: **20試合以上**で勝率60%以上達成時
- ✅ **勝率70%達成**: **30試合以上**で勝率70%以上達成時

#### 連勝系マイルストーン
- ✅ **3連勝達成**: 3連勝時
- ✅ **5連勝達成**: 5連勝時
- ✅ **10連勝達成**: 10連勝時

#### 参加系マイルストーン
- ✅ **皆勤賞**: 1ヶ月間全大会参加
- ✅ **大会10回参加**: 通算大会参加10回
- ✅ **大会50回参加**: 通算大会参加50回

#### 特殊マイルストーン
- ✅ **両ルール制覇**: トランプ・カード+両方で勝利
- ✅ **逆転王**: 大きなレーティング差を覆して勝利
- ✅ **安定王**: 30試合でレーティング変動幅±50以内

## 実装スケジュール

### Phase 1: 基本統計機能（2025年8月）
- [ ] 勝率計算機能の実装
- [ ] 通算統計と年間統計の分離
- [ ] 統計ページのデータベース連動

### Phase 2: 実績システム（2025年9月）
- [ ] マイルストーン判定ロジック実装
- [ ] 実績ページのデータベース連動
- [ ] チャンピオンバッジ表示システム

### Phase 3: 年間サイクル（2025年11月）
- [ ] 年末自動チャンピオン決定機能
- [ ] 年始自動リセット機能
- [ ] 年別データアーカイブ機能

### Phase 4: 年末運用（2025年12月）
- [ ] 年間サイクルのテスト運用
- [ ] 2025年チャンピオン決定
- [ ] 2026年システム稼働開始

## 技術仕様

### 自動実行システム
- **Vercel Cron Jobs**または**GitHub Actions**を使用
- 年末・年始の自動処理をスケジューリング
- エラー時の管理者通知機能

### データ整合性
- アーカイブ前のデータバックアップ
- ロールバック機能の実装
- データ移行の整合性チェック

## ユーザーエクスペリエンス

### モチベーション向上要素
1. **視覚的な達成感**: バッジ・マイルストーンの獲得
2. **競争要素**: 年間ランキング・リアルタイム順位
3. **成長実感**: 統計データでの上達確認
4. **継続性**: 年をまたいだ長期記録保持

### ゲーミフィケーション
- マイルストーン達成時の祝福表示
- バッジコレクション要素
- 年間目標設定機能
- 個人記録の可視化

## 関連ドキュメント
- [ELOレーティングシステム](./elo_rating_system.md)
- [統計機能仕様](./statistics_specification.md)
- [実績システム設計](./achievement_system.md)