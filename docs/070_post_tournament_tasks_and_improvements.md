# 📋 BUNGU SQUAD ARENA - 大会振り返りと今後の改善タスク 070
**作成日時**: 2025-08-09  
**状況**: 第一回大会終了後の振り返りと今後の開発計画  

## 🎯 第一優先タスク

### 1. 🥇 ゲームルールバッジの自動付与
**現状**: 5名の参加者にトランプ（♠️）バッジが付いていない  
**対応**: 
- 試合完了時の`updatePlayerGameExperience()`呼び出し実装
- 既存プレイヤーへの遡及適用

### 2. 🏆 年間ランキング・メダルシステム
**要件**:
- 年末（12/31）にランキングをリセット
- 年始（1/1）に全員のレーティングを1200に戻す
- 年間1位・2位・3位にメダル付与（🥇🥈🥉）
- メダルは累積表示（連覇や複数回優勝が一目でわかる）
- 2025年終了時点での上位3名にメダル付与

**メダルの仕様**:
- 名前の横に表示
- 年度ごとに累積（例：🥇🥇 = 2回優勝）
- 永続的に保持される名誉の証

## 🔴 大会中に発見された緊急度の高い課題

### 1. 組み合わせ管理の改善
**問題点**:
- 同じプレイヤーが連続で試合に入る（1試合目と2試合目に同じ人）
- テーブル2台運用時に1人しかいない状況が発生

**改善案**:
- 総当たり後の並び替え機能
- 連続試合の自動検出・警告
- 手動での順序調整機能

### 1-2. 🆕 次の試合選択の柔軟性向上【重要】
**現状の問題**:
- 「次の試合」に1組しか表示されない
- 組み合わせ順序通りでしか進行できない
- プレイヤーが対戦中でも順番待ちが発生

**具体例**:
```
1試合目: A vs B (進行中)
2試合目: C vs D (完了) 
3試合目: A vs E (Aが対戦中で待機)
4試合目: C vs F (実は開始可能)
```

**改善案**:
- **次の試合候補を複数表示**（3-5試合程度）
- **対戦可能な組み合わせを優先表示**
  - 両プレイヤーが空いている組み合わせ
  - 対戦中プレイヤーを含む組み合わせは下位表示
- **管理者による柔軟な試合選択**
  - 順番にこだわらず効率重視
  - 待ち時間の最小化
- **スキップ機能**
  - 「この試合を後回し」ボタン
  - 一時的に順序を変更

**期待効果**:
- 大会進行の大幅なスピードアップ
- プレイヤーの待ち時間削減
- 複数テーブル運用時の効率向上

### 2. ドラッグ&ドロップUIの改善
**問題点**:
- 画面外へのドラッグ時にスクロールしない
- 下から上への移動が困難

**改善案**:
- 自動スクロール機能の実装
- ドラッグ中の画面追従

### 3. 🚨 大会終了時のプレイヤー非アクティブ化問題【緊急】
**問題点**:
- 大会終了ボタンを押しても参加者が非アクティブにならない
- 次回大会作成時に前回参加者が全員エントリー済み状態になる
- 新しい大会なのに既に参加者がいる状態で開始される

**期待動作**:
- 大会終了ボタン押下時：
  1. 開催中大会 → 完了大会に移動 ✅（動作中）
  2. 参加プレイヤーの`tournament_active` → FALSE ❌（未動作）

**対応必要**:
- `/api/admin.js`の`handleEndTournament()`機能の修正確認
- `deactivateTournamentParticipants()`の動作確認

### 4. レスポンス速度の改善
**特に遅い箇所**:
- 試合開始ボタン → 試合中への移行（体感10秒）
- 試合結果入力 → 完了への移行（体感10秒）
- 大会作成 → 本日の大会表示（体感20秒）

**特に速すぎる箇所**:
- 試合管理タブの自動更新（2秒 → 5-10秒でも可）

## 🟡 中優先度の改善項目

### 1. QRエントリーの安定性向上
**問題点**:
- エントリー押下後も登録のみで参加できていないケース
- 再度カメラ起動してエントリーが必要な場合がある

### 2. 試合結果のレート変動表示
**追加場所**:
- 参加者画面のリアルタイム結果表示（現在0表示）
- 管理者画面の大会運営結果表示

### 3. アプリ起動時の白画面問題
**症状**: 初回起動時に白画面
**対処**: バックグラウンドから削除して再起動
**改善**: Service Workerの初期化処理見直し

### 4. 試合追加機能の改善
**完了済み（現地修正）**:
- 既存試合データを保持したまま追加
- 組み合わせ設定から複数試合一括追加

## 🟢 今後実装したい新機能

### 1. 📱 通知システム
- 組み合わせ決定通知
- 大会開始・終了通知
- プッシュ通知対応

### 2. 📊 統計機能の完全実装
**現状**: 現在レーティングのみ機能
**必要な実装**:
- 勝率計算
- 最近の成績（直近10試合など）
- 月別成績
- ゲームルール別統計
- 対戦相手別成績

### 3. 🏅 実績・マイルストーンの再設計
**課題**: 内容が重複している。プロフィールの実績バッジと
**改善案**:
- 実績：達成型（初勝利、10連勝など）
- マイルストーン：累積型（通算100勝など）
- プロフィールでの表示方法検討
- 勝率50%は、10戦以上やってからの判断
- レート1600突破はかなり大変そう。4連勝した人でも1200→1273なので、ここの目標値をもっと現実味のある数値に

## 📊 現在の完成度評価

| 機能 | 完成度 | 備考 |
|------|--------|------|
| **ランキング** | 90% | 年間リセット機能未実装 |
| **履歴** | 95% | ほぼ完璧 |
| **統計** | 20% | 現在レーティングのみ |
| **実績** | 30% | 再設計検討中 |
| **プロフィール** | 40% | バッジ・メダル未実装 |
| **設定** | 10% | 通知設定未実装 |
| **大会運営** | 85% | UI改善の余地あり |
| **QRエントリー** | 80% | 安定性向上必要 |

## 🚀 今後の開発ロードマップ

### Phase 1（1-2週間）【緊急】
1. 🚨 **大会終了時のプレイヤー非アクティブ化修正**
2. ✅ バッジ自動付与の実装
3. ✅ レート変動表示の追加
4. ✅ レスポンス速度の最適化

### Phase 2（3-4週間）
1. ✅ **次の試合選択の柔軟性向上**（複数候補表示・スキップ機能）
2. ✅ 組み合わせ管理UI改善
3. ✅ 年間ランキング・メダルシステム
4. ✅ 統計機能の実装
5. ✅ プレイヤーランキングの試合数表示を0試合になっているので修正

### Phase 3（1ヶ月後）
1. ✅ 通知システム
2. ✅ 実績・マイルストーン再設計
3. ✅ QRエントリー安定性向上

## 💡 革新的だった変更

**組み合わせ追加の柔軟性**:
- 単体追加：「試合を追加」ボタン
- 複数追加：「組み合わせ設定」から一括追加
- 既存試合を保持したまま追加可能

この変更により、大会中の柔軟な運営が可能になった。

## 📝 メモ

### 大会運営の実績
- 5人総当たり戦：10試合
- 2テーブル同時進行
- 途中参加者への対応成功
- レーティング計算正常動作

### 参加者の反応
- レート変動が見えることへの好評価
- 履歴機能への満足度高い
- 待ち時間の可視化要望あり

---
**次回大会までの目標**: Phase 1完了、Phase 2着手  
**長期目標**: 年末までに全機能実装完了