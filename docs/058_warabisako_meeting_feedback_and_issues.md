# 058_warabisako_meeting_feedback_and_issues.md

## 概要
ワラビサコさんとの打ち合わせ（2025-08-02）で発見された問題と改善要望のまとめ

## 発見された重要な問題

### 🔴 最重要：組み合わせ後の試合追加エラー
**症状**: 
- 組み合わせを組んだ後に「新しい試合を追加」ボタンで試合を追加しようとするとエラー
- 何回試行してもエラーが継続
- キャンセルすると今まで組んでいた組み合わせが全て消失

**エラー詳細**（コンソールログより）:
```
GET /api/rankings - 500 (Internal Server Error)
GET /api/tournaments - 500 (Internal Server Error)  
GET /api/matches - 500 (Internal Server Error)
POST /api/matches - 500 (Internal Server Error)
```

**影響**:
- 途中参加者が追加できない
- 試合の柔軟な運営ができない
- 組み合わせのやり直しが必要になる

**対応優先度**: 最高（高優先度）

### 🔴 試合管理機能の不足

#### 1. 試合キャンセル機能がない
**問題**: 
- 試合開始後に参加者間違いが発覚した場合の対処法がない
- 試合途中でキャンセルする機能が存在しない

**要望**: 
- 試合途中でもキャンセルできる機能を追加

#### 2. 完了済み試合の修正・削除機能がない
**問題**:
- 完了した試合の結果を後から修正できない
- 間違った試合を削除できない

**要望**:
- 完了済み試合の編集機能
- 完了済み試合の削除機能

#### 3. 無効試合オプションがない
**問題**:
- 勝ち・負け以外の結果選択肢がない
- 何らかの理由で試合が無効になった場合の対処法がない
- レーティング計算から除外したい試合への対応がない

**要望**:
- 試合結果に「無効試合」オプションを追加
- 無効試合に設定した場合はレーティング計算を行わない
- 試合中でも無効試合に設定できる機能

**想定される無効試合のケース**:
- 参加者の体調不良
- ルール違反の発生
- 外的要因（時間切れ、機材トラブル等）
- その他運営上の判断

## 運営上の新しい要望

### 🔴 複数試合同時進行システム
**現状の問題**:
- 現在は1試合ずつしか進行できない
- 大会会場によっては複数卓での同時進行が必要

**要望詳細**:
- 最大4卓での同時進行
- 一度に8人（4卓×2人）でのゲーム実行
- 複数試合の並行管理

**技術的考慮**:
- 実装が複雑な場合はLovableへの依頼も検討中

### 🔴 途中参加者への対応
**背景**:
- 実際の大会では途中から参加する人がいる
- 組み合わせ決定後にも新しい参加者が来る可能性

**要望**:
- 組み合わせ後でもメンバーを追加できる機能
- 途中参加者用の試合追加機能
- エラーなく安全に追加できるシステム

## UI/UX改善要望

### 🟡 統計機能の調整
**現状の問題**:
- 月別成績が細かすぎる
- 実際には毎月大会を開催しない

**要望**:
- 月別成績を以下のいずれかに変更：
  - 四半期毎の成績
  - 上半期・下半期の成績
  - 年間成績（既存の年間成績との重複を避ける）

**検討事項**:
- メニューの「実績」に既に「年間成績」があるため重複を避ける必要

## 技術的な詳細分析

### エラーの詳細分析
**発生タイミング**:
1. 大会管理で組み合わせを作成
2. 「新しい試合を追加」ダイアログを開く
3. プレイヤー1、プレイヤー2、ゲームタイプを選択
4. 「追加」ボタンをクリック
5. 500エラーが発生

**予想される原因**:
- 既存の組み合わせデータとの競合
- トランザクション管理の問題
- 状態管理の不整合
- API側での例外処理不足

### 実装に必要な機能

#### 試合状態管理の拡張
```javascript
// 必要な試合状態
MATCH_STATUS = {
  SCHEDULED: 'scheduled',     // 予定
  IN_PROGRESS: 'in_progress', // 進行中
  COMPLETED: 'completed',     // 完了
  CANCELLED: 'cancelled',     // キャンセル（新規）
  INVALID: 'invalid'          // 無効試合（新規）
}

// 試合結果タイプ
MATCH_RESULT = {
  PLAYER1_WIN: 'player1_win', // プレイヤー1勝利
  PLAYER2_WIN: 'player2_win', // プレイヤー2勝利
  INVALID: 'invalid'          // 無効試合（新規）
}
```

#### 同時進行管理システム
- 複数試合の状態管理
- 卓番号の管理
- 同時進行試合の制限管理

## 今後の作業計画

### フェーズ1: 緊急修正（最優先）
1. **組み合わせ後の試合追加エラー修正**
   - API側の500エラー原因調査
   - エラーハンドリング改善
   - 状態管理の見直し

2. **試合キャンセル機能実装**
   - キャンセル状態の追加
   - UI上でのキャンセルボタン
   - 関連データの整合性保持

3. **無効試合機能実装**
   - 無効試合の結果選択肢追加
   - レーティング計算の除外処理
   - 試合中での無効設定機能

### フェーズ2: 基本機能拡張
1. **完了済み試合の編集・削除**
   - 管理者権限での編集UI
   - レーティング再計算機能
   - データ整合性確保

2. **途中参加者対応**
   - 動的な参加者追加
   - 組み合わせの再生成
   - 安全な追加プロセス

### フェーズ3: 高度な機能
1. **複数試合同時進行**
   - アーキテクチャ設計
   - 状態管理システム改修
   - UI/UX設計

2. **統計機能調整**
   - 期間設定の変更
   - データ集計ロジック修正

## 技術的検討事項

### Lovable依頼検討対象
- 複数試合同時進行システム
  - 技術的複雑性が高い
  - 大幅なアーキテクチャ変更が必要

### 自力実装対象
- 試合キャンセル機能
- 無効試合機能
- 完了済み試合編集・削除
- 途中参加者対応
- 統計機能調整

## 次回の確認事項

1. 組み合わせ後の試合追加エラーの修正確認
2. 試合キャンセル機能のUI/UX確認
3. 無効試合機能のUI/UX確認（結果選択画面での実装方法）
4. 複数試合同時進行の技術的実現可能性
5. 統計機能の変更方針決定

---
**記録日**: 2025-08-02  
**参加者**: ワラビサコさん、kikuchikenji  
**次回作業**: 緊急修正から順次対応